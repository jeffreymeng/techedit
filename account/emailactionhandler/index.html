<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <title>Techedit</title>

    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <style>
        body {
            padding-top: 70px;
            /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
        }
        
        .hidden {
            display: none;
        }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Techedit</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/new/">New File</a>
                    </li>
                    <li>
                        <a href="/edit/">Edit File</a>
                    </li>
                    <li id="nav-login" class="hidden">
                        <a id="nav-login-link">Login</a>
                    </li>
                    <p id="nav-logout" class="navbar-text navbar-right hidden">You are logged in. <a id="nav-logout-link" class="navbar-link">Logout</a></p>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">


        <p id="loading">Loading...</p>
        <div class="col-lg-12 text-center hidden" id="passwordreset">
            <div class="alert alert-danger hidden" id="weak" role="alert">Error: Your password is too weak. Try adding at least 8 charcters in tottal, captial letters, symbols, and/or numbers</a>.</div>
            <div class="alert alert-danger hidden" id="nomatch" role="alert">Error: The passwords don't match!</div>
            <h1>Reset your techedit password</h1>
            <hr>

            <label for="reset-password">New Password:</label>
            <input type="password" id="reset-password" class="form-control">
            <label for="reset-confirmpassword">Confirm Password:</label>
            <input type="password" id="reset-confirmpassword" class="form-control">
            <br><br>
            <button class="btn btn-primary form-control" id="resetpassword-btn">Update Password</button>
            <hr>
            <p id="option-bar">Or: <a href="/account/create/">Login</a> | <a href="/account/create/">Create an account</a> | <a href="/account/reset/">Reset your password</a></p>
        </div>
        <div class="col-lg-12 text-center hidden" id="invalidlink">
            <h1>Error: Invalid Link</h1>
            <hr>
            <p>This page should be only accessed by clicking a link in a password reset or other type of email. If you want to reset your password, click <a href="/accout/reset">here</a>.</p>
        </div>
        <div class="col-lg-12 text-center hidden" id="invalidcode">
            <h1>Error: Invalid Link</h1>
            <hr>
            <p>The link you used to access this page was invalid. It may have expired, or may have already been used..</p>
        </div>



        <!-- /.row -->

    </div>
    <!-- /.container -->

    <!-- jQuery Version 1.11.1 -->
    <script src="/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.6.3/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBQ2E4ISQoIcRsDxfPxzDjbJwmD-r98JYw",
            authDomain: "techedit-63e7f.firebaseapp.com",
            databaseURL: "https://techedit-63e7f.firebaseio.com",
            storageBucket: "techedit-63e7f.appspot.com",
            messagingSenderId: "609280907475"
        };
        firebase.initializeApp(config);
    </script>
    <script src="/js/techedit.js"></script>
    <script>
        /* global $ firebase */

        function getQuery(name) {
            var url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
        if (getQuery("mode") !== null && getQuery("oobCode") !== null) {
            if (getQuery("mode") === "resetPassword") {

                // Verify the password reset code is valid.
                firebase.auth().verifyPasswordResetCode(getQuery("oobCode")).then(function(email) {
                    $("#loading").addClass("hidden");
                    $("#passwordreset").removeClass("hidden");
                    $("#resetpassword-btn").click(function() {
                        if ($("#reset-password").val() === $("#reset-confirmpassword").val()) {
                            firebase.auth().confirmPasswordReset(getQuery("oobCode"), $("#reset-password").val()).then(function(resp) {
                                window.location.href = "/account/login/#passwordresetsuccess";
                            }).catch(function(error) {
                                $("#codeinvalid").addClass("hidden");
                                $("#nomatch").addClass("hidden");
                                $("#weak").removeClass("hidden");
                            });
                        }
                        else {
                            $("#codeinvalid").addClass("hidden");
                            $("#weak").addClass("hidden");
                            $("#nomatch").removeClass("hidden");
                        }

                    });


                }).catch(function(error) {
                    $("#loading").addClass("hidden");
                    $("#invalidcode").removeClass("hidden");
                });
            }
            else if (getQuery("mode") === "MODE TODO") {

            }
        }
        else {
            $("#loading").addClass("hidden");
            $("#invalidlink").removeClass("hidden");
        }
    </script>
</body>

</html>
