<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">


	<title>Techedit</title>

	<!-- Bootstrap Core CSS -->
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<!-- Font Awesome CSS -->
	<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
	<!-- Social Button CSS -->
	<link rel="stylesheet" href="/css/bootstrap-social.css">
	<!-- Custom CSS -->
	<style>
		body {
			padding-top: 70px;
			/* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
		}
		
		.hidden {
			display: none;
		}
	</style>

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
	<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
	<script type="text/javascript">
		window.cookieconsent_options = {
			"message": "Techedit uses cookies(pieces of text stored on your browser's cache) to ensure you get the best experience on our website.",
			"dismiss": "Got it!",
			"learnMore": "More info",
			"link": "",
			"theme": "light-bottom"
		};
	</script>

	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.10/cookieconsent.min.js"></script>
	<!-- End Cookie Consent plugin -->

</head>

<body>

	<!-- Navigation -->
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/">Techedit</a>
			</div>
			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="navbar-collapse">
				<ul class="nav navbar-nav">
					<li>
						<a href="/new/">New File</a>
					</li>
					<li>
						<a href="/edit/">Edit File</a>
					</li>
					<li id="nav-collection" class="hidden">
						<a id="nav-collection-link" href="/collection/">My Collection</a>
					</li>
					<li id="nav-login" class="hidden">
						<a id="nav-login-link">Login</a>
					</li>
					<li class="dropdown hidden" id="nav-account">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Your Account <span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a id="nav-logout-link">Logout</a></li>

							<li role="separator" class="divider"></li>
							<li><a href="/account/settings/">Account Settings</a></li>
						</ul>
					</li>
					<li class="dropdown" id="nav-account">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a href="/support/">Support Portal</a></li>
							<li><a href="/support/contact/">Contact</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</nav>

	<!-- Page Content -->
	<div class="container">



		<div class="col-lg-12 text-center" id="main">
			<div class="alert alert-danger hidden" id="error" role="alert">Error: No user could be found with the combiation of email address and password given. You can try entering your password again, <a href="/account/create/" class="alert-link">
				Creating an account</a>, or <a href="/account/reset/" class="alert-link">Resetting your password</a>.</div>
			<div class="alert alert-danger hidden" id="accountinvalid" role="alert">The account used to login has not been activated yet. You need to follow a link on a password reset email to activate your account. You can try <a href="/account/verify" class="alert-link">Verifying your email again</a>.</div>
			<div class="alert alert-danger hidden" id="socialloginerror" role="alert">Unable to log you in. Please try again later.</div>
			<div class="alert alert-danger hidden" id="popupdenied" role="alert">Popup denied by browser. Please allow the login popup to be displayed to login.</div>

			<div class="alert alert-success hidden" id="accountcreated" role="alert">Your account was created and activated successfully. You may now login.</div>
			<div class="alert alert-success hidden" id="passwordresetsuccess" role="alert">Your account password was changed successfully. You may now login.</div>
			<div class="alert alert-success hidden" id="recoveremailsuccess" role="alert">Your account email was reverted successfully. You may now login. After logging in, you may want to change your password(Click on account in the navagiation bar, then settings), since your accout may have been compromised if someone else was able to
				gain access to your account and change your email.</div>
			<div class="alert alert-success hidden" id="emailchangesuccess" role="alert">Your account email was changed successfully. If you have not yet verified your email, you will need to do that before you can login. You can <a href="/account/verify">send another verification email</a> if you wish..</div>
			<h1>Login to Techedit</h1>
			<hr>

			<label for="email">Email Address:</label>
			<input type="text" id="email" class="form-control">
			<label for="password">Password:</label>
			<input type="password" id="password" class="form-control">
			<br><br>
			<button class="btn btn-primary form-control" id="login">Login</button>
			<hr>
			<p class="text-center">Or:</p>
			<a class="btn btn-block btn-social btn-google social-login" id="google-login">
				<span class="fa fa-google"></span> Login with Google
			</a>
			<a class="btn btn-block btn-social btn-github social-login" id="github-login">
				<span class="fa fa-github"></span> Login with Github
			</a>
			<hr>
			<p id="option-bar">Or: <a href="/account/create/">Create an account</a> | <a href="/account/reset/">Reset your password</a> | <a href="/account/verify/">Send another email address verification email</a></p>
		</div>
		<div class="col-lg-12 text-center hidden" id="loggedin">
			<h1>Login to Techedit</h1>
			<hr>
			<p>
				You are already logged in. If you want to login again, or swich accounts, you can <a id="loggedin-logout">Logout</a>, then come back to login.
			</p>
		</div>



		<!-- /.row -->

	</div>
	<!-- /.container -->

	<!-- jQuery Version 1.11.1 -->
	<script src="/js/jquery.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="/js/bootstrap.min.js"></script>
	<script src="https://www.gstatic.com/firebasejs/3.6.3/firebase.js"></script>
	<script>
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyBQ2E4ISQoIcRsDxfPxzDjbJwmD-r98JYw",
			authDomain: "techedit-63e7f.firebaseapp.com",
			databaseURL: "https://techedit-63e7f.firebaseio.com",
			storageBucket: "techedit-63e7f.appspot.com",
			messagingSenderId: "609280907475"
		};
		firebase.initializeApp(config);
	</script>
	<script src="/js/techedit.js"></script>
	<script>
		/* global $ firebase */
		function getQuery(name) {
			var url = window.location.href;
			name = name.replace(/[\[\]]/g, "\\$&");
			var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
				results = regex.exec(url);
			if (!results) return null;
			if (!results[2]) return '';
			return decodeURIComponent(results[2].replace(/\+/g, " "));
		}
		firebase.auth().onAuthStateChanged(function(user) {
			if (user) {
				$("#main").addClass("hidden");
				$("#loggedin").removeClass("hidden");
				$("#loggedin-logout").click(function() {
					window.location.href = "/account/logout/?redir=" + encodeURIComponent(window.location.href);
				});
			}
			else {
				$("#loggedin").addClass("hidden");
				$("#main").removeClass("hidden");
				if (window.location.hash === "#accountcreated") {
					$("#accountcreated").removeClass("hidden");
					window.location.hash = "";
				}
				else if (window.location.hash === "#passwordresetsuccess") {
					$("#passwordresetsuccess").removeClass("hidden");
					window.location.hash = "";
				}
				else if (window.location.hash === "#emailverified") {
					$("#emailverified").removeClass("hidden");
					window.location.hash = "";
				}
				else if (window.location.hash === "#recoveremailsuccess") {
					$("#recoveremailsuccess").removeClass("hidden");
					window.location.hash = "";
				}
				else if (window.location.hash === "#emailchangesuccess") {
					$("#emailchangesuccess").removeClass("hidden");
					window.location.hash = "";
				}



				$("#login").click(login);
				$(".social-login").click(function() {
					var id = $(this).attr("id");
					var provider;
					if (id === "google-login") {
						provider = new firebase.auth.GoogleAuthProvider();

					}
					else if (id === "github-login") {
						provider = new firebase.auth.GithubAuthProvider();
					}
					else {
						//error
						return;
					}
					if (provider) {
						firebase.auth().signInWithPopup(provider).then(function(result) {
							window.location.href = getQuery("redir") || "/collection/";
						}).catch(function(error) {
							if (error.code === "auth/popup-blocked") {
								$("#socialloginerror").addClass("hidden");
								$("#accountcreated").addClass("hidden");
								$("#accountinvalid").addClass("hidden");
								$("#error").addClass("hidden");
								$("#popupdenied").removeClass("hidden");
							}
							else {

								$("#accountcreated").addClass("hidden");
								$("#accountinvalid").addClass("hidden");
								$("#error").addClass("hidden");
								$("#popupdenied").addClass("hidden");
								$("#socialloginerror").removeClass("hidden");
							}
						});
					}
				});

				$(document).keypress(function(e) {
					var key = e.which;
					if (key == 13) // the enter key code
					{
						login();
					}
				});


			}
		});

		function login() {
			var email = $("#email").val();
			var password = $("#password").val();
			firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
				$("#password").val("");
				$("#accountcreated").addClass("hidden");
				$("#accountinvalid").addClass("hidden");
				$("#socialloginerror").addClass("hidden");
				$("#popupdenied").addClass("hidden");
				$("#error").removeClass("hidden");
			}).then(function() {
				firebase.auth().onAuthStateChanged(function(user) {
					if (user) {
						if (user.emailVerified) {
							window.location.href = getQuery("redir") || "/collection/";
						}
						else {
							
							firebase.auth().signOut().then(function() {
								console.log(1);
								$("#loggedin").addClass("hidden");
								$("#main").removeClass("hidden");
								$("#password").val("");
								$("#accountcreated").addClass("hidden");
								$("#error").addClass("hidden");
								$("#socialloginerror").addClass("hidden");
								$("#popupdenied").addClass("hidden");
								$("#accountinvalid").removeClass("hidden");
							});
						}
					}
					else {
						$("#password").val("");
						$("#accountcreated").addClass("hidden");
						$("#accountinvalid").addClass("hidden");
						$("#socialloginerror").addClass("hidden");
						$("#popupdenied").addClass("hidden");
						$("#error").removeClass("hidden");
					}
				});


			});
		}
	</script>
</body>

</html>
