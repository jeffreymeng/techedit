<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">


	<title>Techedit</title>

	<!-- Bootstrap Core CSS -->
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<!-- Social Button CSS -->
	<link rel="stylesheet" href="/css/bootstrap-social.css">
	<!-- Font Awesome CSS -->
	<link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
	<!-- Custom CSS -->
	<style>
		body {
			padding-top: 70px;
			/* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
		}
		
		#files {
			list-style-type: none;
		}
	</style>

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
	<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
	<script type="text/javascript">
		window.cookieconsent_options = {
			"message": "Techedit uses cookies(pieces of text stored on your browser's cache) to ensure you get the best experience on our website.",
			"dismiss": "Got it!",
			"learnMore": "More info",
			"link": "",
			"theme": "light-bottom"
		};
	</script>

	<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.10/cookieconsent.min.js"></script>
	<!-- End Cookie Consent plugin -->

</head>

<body>

	<!-- Navigation -->
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/">Techedit</a>
			</div>
			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="navbar-collapse">
				<ul class="nav navbar-nav">
					<li>
						<a href="/new/">New File</a>
					</li>
					<li>
						<a href="/edit/">Edit File</a>
					</li>
					<li id="nav-collection" class="hidden">
						<a id="nav-collection-link" href="/collection/">My Collection</a>
					</li>
					<li id="nav-login" class="hidden">
						<a id="nav-login-link">Login</a>
					</li>
					<li class="dropdown hidden" id="nav-account">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Your Account <span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a id="nav-logout-link">Logout</a></li>

							<li role="separator" class="divider"></li>
							<li><a href="/account/settings/">Account Settings</a></li>
						</ul>
					</li>
					<li class="dropdown" id="nav-account">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a href="/support/">Support Portal</a></li>
							<li><a href="/support/contact/">Contact</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container -->
	</nav>

	<!-- Page Content -->
	<div class="container">



		<div class="col-lg-12 text-center">
			<h1>Account Settings</h1>
			<hr>
			<div>

				<!-- Nav tabs -->
				<ul class="nav nav-tabs" role="tablist">
					<li role="presentation" class="active"><a href="#login-methods-div" aria-controls="login-methods-div" role="tab" data-toggle="tab">Login Methods</a></li>
					<li role="presentation" class="hidden" id="update-email-tab"><a href="#update-email" aria-controls="update-email" role="tab" data-toggle="tab">Update email</a></li>
					<li role="presentation" class="hidden" id="update-password-tab"><a href="#update-password" aria-controls="update-password" role="tab" data-toggle="tab">Update password</a></li>
					<li role="presentation" id="collection-tab"><a href="#collection" aria-controls="collection" role="tab" data-toggle="tab">Collection Settings</a></li>
					<li role="presentation" id="delete-tab"><a href="#delete" aria-controls="delete" role="tab" data-toggle="tab">Delete Account</a></li>
				</ul>

				<!-- Tab panes -->
				<div class="tab-content">
					<div role="tabpanel" class="tab-pane fade in active" id="login-methods-div">
						<div class="alert alert-success hidden" role="alert" id="link-update-success">Successfully updated your login methods. If you added an email/password login method, then you will need to verify your email before you can login with it.</div>
						<div class="alert alert-danger hidden" role="alert" id="link-update-error">There was an error while updating your login methods.</div>
						<div class="alert alert-danger hidden" role="alert" id="link-account-in-use">The login method is already in use with another account.
							<!-- <a href="/support/account/login-methods/#error-login-method-already-in-use">Learn More</a>. --></div>
						<div class="alert alert-danger hidden" role="alert" id="link-account-in-use">The passwords don't match!</div>
						<h3>Login Methods</h3>
						<div id="login-methods"></div>
						<div id="link-buttons">
							<div id="password-link" class="hidden">
								<label for="password-link-email">Email for adding email/password login:</label>
								<input class="form-control" type="text" id="password-link-email">
								<label for="password-link-password">Password for adding email/password login:</label>
								<input class="form-control" type="password" id="password-link-password">
								<label for="password-link-password">Confirm password for adding email/password login:</label>
								<input class="form-control" type="password" id="password-link-confirm-password">
								<br>
								<button class="btn btn-primary link-login form-control" id="password-link-btn">Add email/password login</button>
							</div>
							<br>
							<a class="hidden btn btn-block btn-social btn-google link-login" id="google-link">
								<span class="fa fa-google"></span> Add Google login
							</a>
							<br>
							<a class="hidden btn btn-block btn-social btn-github link-login" id="github-link">
								<span class="fa fa-github"></span> Add Github login
							</a>
						</div>
					</div>
					<div role="tabpanel" class="tab-pane fade" id="update-email">
						<div class="alert alert-success hidden" role="alert" id="update-email-success">Successfully updated your email.</div>
						<div class="alert alert-danger hidden" role="alert" id="update-email-reauth-error">Error. The email/current - password comboniation could not be found.</div>
						<div class="alert alert-danger hidden" role="alert" id="update-email-error">Error updating your email. The email may already be in use, or may be badly formatted. </div>

						<h3>Update Your account email address</h3>

						<label for="update-email-new-email">New Email:</label>

						<input class="form-control" type="text" id="update-email-new-email">
						<button id="update-email-btn" class="form-control btn btn-primary">Update Email</button>
					</div>
					<div role="tabpanel" class="tab-pane fade" id="update-password">
						<div class="alert alert-success hidden" role="alert" id="update-password-success">Successfully updated your password.</div>
						<div class="alert alert-danger hidden" role="alert" id="update-password-reauth-error">Error. The email/current - password comboniation could not be found.</div>
						<div class="alert alert-danger hidden" role="alert" id="update-password-error">Error updating your password. The password may not be strong enough, or some other error occured.</div>
						<div class="alert alert-danger hidden" role="alert" id="update-password-nomatch">Error updating your password. The passwords do not match.</div>
						<h3>Update Your account password</h3>
						<b>All password update fields are required.</b>
						<br>

						<label for="update-password-new-password">New Password:</label>
						<input class="form-control" type="password" id="update-password-new-password">
						<label for="update-password-confirm-password">Confirm New Password:</label>
						<input class="form-control" type="password" id="update-password-confirm-password">
						<button id="update-password-btn" class="form-control btn btn-primary">Update Password</button>
					</div>
					<div role="tabpanel" class="tab-pane fade" id="collection">
						<h1>Collection Settings</h1>
						<a id="collection-export">Export Collection</a>
						<br>
						<a id="import-collection-link">Import Collection</a>

						<hr>
						<button class="form-control btn btn-danger" id="collection-clear">Clear your collection</button>
						<hr>

					</div>
					<div role="tabpanel" class="tab-pane fade" id="delete">
						<div class="alert alert-success hidden" role="alert" id="delete-error">An unknown error occured. Please try again.</div>
						<h1>Delete your account</h1>
						<button class="form-control btn btn-danger" id="delete-btn">Delete your account</button>

					</div>
				</div>

			</div>

		</div>

		<!-- 
			TODO:
			Link Accounts    DONE
			Unlink Accounts  DONE
			Change Email     DONE
			Change Password  DONE
			Delete Account
			Clear Collection DONE
			-->
	</div>



	<!-- /.row -->

	</div>
	<!-- /.container -->

	<!-- jQuery Version 1.11.1 -->
	<script src="/js/jquery.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="/js/bootstrap.min.js"></script>
	<script src="/js/list.js"></script>
	<script src="/js/list.pagnation.js"></script>
	<script src="/js/list.fuzzysearch.js"></script>

	<script src="https://www.gstatic.com/firebasejs/3.6.4/firebase.js"></script>
	<script>
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyBQ2E4ISQoIcRsDxfPxzDjbJwmD-r98JYw",
			authDomain: "techedit-63e7f.firebaseapp.com",
			databaseURL: "https://techedit-63e7f.firebaseio.com",
			storageBucket: "techedit-63e7f.appspot.com",
			messagingSenderId: "609280907475"
		};
		firebase.initializeApp(config);
	</script>
	<script src="/js/techedit.js"></script>
	<script>
		/* global $ firebase */
		$('#myTab a').click(function(e) {
			e.preventDefault();
			$(this).tab('show');
		});

		// store the currently selected tab in the hash value
		$("ul.nav-tabs > li > a").on("shown.bs.tab", function(e) {
			var id = $(e.target).attr("href").substr(1);
			window.location.hash = id;
		});

		// on load of the page: switch to the currently selected tab
		var hash = window.location.hash;
		$('#myTab a[href="' + hash + '"]').tab('show');
		firebase.auth().onAuthStateChanged(function(user) {
			if (user) {

				displayLinkedAccounts(user);
				updateEmail(user);
				updatePassword(user);

				collectionSettings(user);
				deleteAccount(user);
			}
			else {
				window.location.href = "/account/login/?redir=" + encodeURIComponent(window.location.href);
			}
		});

		function removeElementFromArrayByValue(array, val) {
			var index = array.indexOf(val);

			if (index > -1) {
				array.splice(index, 1);
			}
			return array;
		}

		function deleteAccount(user) {
			$("#delete-btn").click(function() {
				reauthenticate(user, "Are you sure you want to delete your account?",
					"You will not be able to access your account again. If you try to login with the same login methods, there will be an error, or an account with new data will be created. It is recommended you export your collection first. A copy of your collection will be automatically downloaded if you delete your account. <b>This action is final. Your data will be deleted immediatly. If you are unsure, you may want to wait.</b>",
					function() {
						var user = firebase.auth().currentUser;

						user.delete().then(function() {
							for (var i = 0; i < user.providerData.length; i++) {
								if (user.providerData[i].email !== null) {
									firebase.database.ref("/u/" + user.uid + "/email/").set(user.providerData[i].email);
								}
							}
							firebase.database.ref("/u/" + user.uid + "/status/").set("DELETED");

							window.location.href = "/accounts/logout?continue=" + encodeURIComponent("https://techedit.jeffkmeng.com/accounts/login#accountdeleted");
						}, function(error) {
							$("#delete-error").removeClass("hidden");
						});
					});

			});

		}

		function collectionSettings(user) {

			firebase.database().ref("/u/" + user.uid + "/collections/").on("value", function(snapshot) {
				var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(snapshot.val(), null, 2));
				$("#collection-export").attr("href", dataStr);
				$("#collection-export").attr("download", "techedit-collection-export.json");
			});
			$("#collection-clear").click(function() {
				confirmAction("Are you sure you want to clear your entire collection?",
					"This will delete all your collected files. This action is not reversible, and once deleted, your data cannot be recovered. Once you clear your collection," +
					"Your collection will be empty. You can still add files to your collection. You can export your collection before deleting.(Click on cancel, then the export collection link.)",
					function() {
						firebase.database().ref("/u/" + user.uid + "/collections/").set(null);
					});
			});
			$("#import-collection-link").click(function() {
				$("#import-modal").modal("show");
			});
			$("#import-collection-btn").click(function() {
				if (!window.FileReader) {
					$(".alert").addClass("hidden");
					$("#import-file-not-supported").removeClass("hidden");
				}
				var input = $("#import-file").get(0);

				// Create a reader object
				var reader = new FileReader();
				if (input.files.length) {
					var textFile = input.files[0];
					reader.readAsText(textFile);
					$(reader).on('load', processFile);
				}
				else {
					$(".alert").addClass("hidden");
					$("#import-file-not-formatted").removeClass("hidden");
				}
			});

			function processFile(e) {
				var file = e.target.result,
					data;
				$("#import-modal-main").addClass("hidden");
				$("#import-modal-loading").removeClass("hidden");
				if (file && file.length) {
					data = JSON.parse(file);
					console.log(data);
					var value;
					var error = false;
					for (var key in data) {
						if (data.hasOwnProperty(key)) {
							value = data[key];
							console.log(key + " -> " + value);


							if (key.match(/[123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ]{6}/g) && Object.prototype.toString.call(value) === '[object Object]') {
								if (value.name !== null && value.description !== null) {
									continue;
								}
								else {

									$(".alert").addClass("hidden");
									$("#import-file-not-formatted").removeClass("hidden");
									error = true;
								}
							}
							else {
								$(".alert").addClass("hidden");
								$("#import-file-not-formatted").removeClass("hidden");
								error = true;
							}



						}
					}
					console.log(error);

					if (!error) {
						for (key in data) {
							if (data.hasOwnProperty(key)) {
								value = data[key];
								firebase.database().ref(user.uid + "/collections/" + key + "/").once("value").then(function(snapshot) {
									if (snapshot.val() === null) {

										console.log("set " + user.uid + "/collections/" + key + "/ to:");
										console.log(value);
										//firebase.database().ref(user.uid + "/collections/" + key + "/").set(value);
									}
									else {
										$("#import-modal-loading").addClass("hidden");
										$("#import-modal-conflict").removeClass("hidden");
										console.log("conflict when setting " + user.uid + "/collections/" + key + "/ to:");
										console.log(value);
										console.log("already defined.");
										console.log(snapshot.val());
									}
								});
							}
						}
					}

				}
			}

		}

		function updateEmail(user) {

			for (var i = 0; i < user.providerData.length; i++) {
				if (user.providerData[i].providerId === "password") {
					$("#update-email-tab").removeClass("hidden");
					$("#update-email-btn").click(function() {

						reauthenticate(user, "Are you sure you want to change your Login email?",
							"You will not be able to login with the old email anymore. You will only be able to login with the new email and you will need to verify the new email before you can login with it." +
							"You will also recive an email in your old email account with a link to revert this action. This will only affect email/password login",

							function() {
								var user = firebase.auth().currentUser;
								for (var i = 0; i < user.providerData.length; i++) {
									if (user.providerData[i].email !== null) {
										firebase.database.ref("/u/" + user.uid + "/email/").set(user.providerData[i].email);
									}
								}
								user.updateEmail($("#update-email-new-email").val()).then(function() {
									user.sendEmailVerification().then(function() {

										window.location.href = "/account/logout?continue=" + encodeURIComponent("https://techedit.jeffkmeng.com/account/login#emailchangesuccess");

									});
								});
							});



					});
				}

			}

		}

		function updatePassword(user) {

			for (var i = 0; i < user.providerData.length; i++) {
				if (user.providerData[i].providerId === "password") {
					$("#update-password-tab").removeClass("hidden");
					$("#update-password-btn").click(function() {

						reauthenticate(user, "Are you sure you want to change your password?",
							"You will not be able to login with the old password anymore. You can reset your password at any time by clicking on the reset your password link on the login page. This will only affect email/password login.",

							function() {
								$("#confirm-modal").modal("hide");
								var user = firebase.auth().currentUser;
								user.updatePassword($("#update-password-new-password").val()).then(function() {
									window.location.href = "/account/logout?continue=" + encodeURIComponent("https://techedit.jeffkmeng.com/account/login#passwordchanged");

								}, function(error) {
									$(".alert").addClass("hidden");
									$("#update-password-error").removeClass("hidden");
								});

							});

					});
				}

			}

		}

		function reauthenticate(user, title, text, callback) {
			$("#confirm-modal-label").html(title);
			$("#confirm-modal-text").html(text);
			$("#confirm-modal").modal("show");

			$("#confirm-modal-login").click(function() {
				var email = $("#confirm-modal-email").val();
				var password = $("#confirm-modal-password").val();

				user.reauthenticate(firebase.auth.EmailAuthProvider.credential(email, password)).then(function() {
					$("#confirm-modal").modal("hide");
					callback();
					//console.log("reauthentication success!");
				}, function(error) {
					$(".alert").addClass("hidden");

					$("#confirm-modal-error").removeClass("hidden");
					console.log(error);
				});


			});

			$(".social-login").click(function() {
				console.log("sl-1");
				var id = $(this).attr("id");
				var provider;
				if (id === "confirm-modal-google-login") {
					console.log("sl-google")
					provider = new firebase.auth.GoogleAuthProvider();

				}
				else if (id === "confirm-modal-github-login") {
					console.log("sl-github")
					provider = new firebase.auth.GithubAuthProvider();
				}
				else {
					console.log("sl-error")
						//error
					return;
				}
				if (provider) {
					console.log(2)
					firebase.auth().signInWithPopup(provider).then(function(result) {
						// GET CREDENTAL
						user.reauthenticate(result.credential).then(function() {
							console.log(3)
							$("#confirm-modal").modal("hide");
							callback();
							//console.log("reauthentication success!");
						}, function(error) {
							$(".alert").addClass("hidden");

							$("#confirm-modal-error").removeClass("hidden");
							console.log(error);
						});
					}).catch(function(error) {
						if (error.code === "auth/popup-blocked") {
							$(".alert").addClass("hidden");
							$("#confirm-modal-popupdenied").removeClass("hidden");
						}
						else {

							$(".alert").addClass("hidden");
							$("#confirm-modal-socialloginerror").removeClass("hidden");
						}
					});
				}
			});
		}

		function displayLinkedAccounts(user) {
			var data;
			var providersLeft = ["password", "google.com", "github.com"];
			$("#login-methods").html("");
			$("#password-link").addClass("hidden");
			$("#github-link").addClass("hidden");
			$("#google-link").addClass("hidden");
			if (user.providerData.length > 1) {
				for (var i = 0; i < user.providerData.length; i++) {
					data = user.providerData[i];
					removeElementFromArrayByValue(providersLeft, data.providerId);
					$("#login-methods").append("<p><b>" + data.providerId + "</b> | <a class='unlink-btn' id='unlink-" + data.providerId + "'>Remove this method</a></p>");


				}
			}
			else {
				data = user.providerData[0];
				removeElementFromArrayByValue(providersLeft, data.providerId);
				$("#login-methods").append("<p><b>" + data.providerId === "password" ? "email/password" : data.providerId.replace(".com", "") + "</b></p>");

			}
			for (i = 0; i < providersLeft.length; i++) {
				if (providersLeft[i] === "google.com") {
					$("#google-link").removeClass("hidden");
				}
				else if (providersLeft[i] === "github.com") {
					$("#github-link").removeClass("hidden");
				}
				else {
					$("#password-link").removeClass("hidden");
				}
			}
			$(".unlink-btn").click(function() {
				var unlinkProvider;
				var unlinkProviderFull;
				var id = $(this).attr("id");
				if (id === "unlink-google.com") {
					unlinkProvider = "google";
					unlinkProviderFull = "google.com";
				}
				else if (id === "unlink-github.com") {
					unlinkProvider = "github";
					unlinkProviderFull = "github.com";
				}
				else {
					unlinkProvider = "password";
					unlinkProviderFull = "password";
				}
				reauthenticate(user, "Are you sure you want to remove the " + unlinkProvider + " login method form your account?",
					"This means that in the future, if you login with this method, a new account will be created with new data.",
					function() {
						$("#confirm-modal").modal("hide");
						user.unlink(unlinkProviderFull).then(function() {
							displayLinkedAccounts(user);
							$(".alert").addClass("hidden");
							$("#login-update-success").removeClass("hidden");

						}, function(error) {
							console.log(error);
							displayLinkedAccounts(user);
							$(".alert").addClass("hidden");
							$("#login-update-error").removeClass("hidden");

						});
					});

			});
			$(".link-login").click(function() {
				var linkProvider;
				//var linkProviderName;
				//var linkProviderFull;
				var id = $(this).attr("id");
				reauthenticate(user, "Are you sure you want to add a login method to your account?",
					"This will allow any person with access to your outside login method's account to access your techedit account.",
					function() {
						if (id === "google-link") {
							linkProvider = new firebase.auth.GoogleAuthProvider();

							//linkProviderName = "google";
							//linkProviderFull = "google.com";
							firebase.auth().currentUser.linkWithPopup(linkProvider).then(function(result) {
								$(".alert").addClass("hidden");
								$("#link-update-success").removeClass("hidden");
								displayLinkedAccounts(user);
							}).catch(function(error) {
								//console.log(error);
								if (error.code === "auth/email-already-in-use" || error.code === "auth/credential-already-in-use") {
									$(".alert").addClass("hidden");
									$("#link-account-in-use").removeClass("hidden");
									displayLinkedAccounts(user);
								}
								else {
									$(".alert").addClass("hidden");
									$("#link-update-error").removeClass("hidden");
									displayLinkedAccounts(user);
								}
							});
						}
						else if (id === "github-link") {
							linkProvider = new firebase.auth.GithubAuthProvider();
							//linkProviderName = "github";
							//linkProviderFull = "github.com";
							firebase.auth().currentUser.linkWithPopup(linkProvider).then(function(result) {
								$(".alert").addClass("hidden");
								$("#link-update-success").removeClass("hidden");
								displayLinkedAccounts(user);
							}).catch(function(error) {
								//console.log(error);
								if (error.code === "auth/email-already-in-use" || error.code === "auth/credential-already-in-use") {
									$(".alert").addClass("hidden");
									$("#link-account-in-use").removeClass("hidden");
									displayLinkedAccounts(user);
								}
								else {
									$(".alert").addClass("hidden");
									$("#link-update-error").removeClass("hidden");
									displayLinkedAccounts(user);
								}
							});
						}
						else {
							if ($("#password-link-password").val() !== $("#password-link-confirm-password").val()) {
								$(".alert").addClass("hidden");
								$("#link-password-nomatch").removeClass("hidden");
								displayLinkedAccounts(user);
							}
							else {
								linkProvider = firebase.auth.EmailAuthProvider.credential($("#password-link-email").val(), $("#password-link-password").val());
								//linkProviderName = "password";
								//linkProviderFull = "password";
								firebase.auth().currentUser.link(linkProvider).then(function(user) {
									user.sendEmailVerification().then(function() {
										$(".alert").addClass("hidden");
										$("#link-update-success").removeClass("hidden");
										displayLinkedAccounts(user);
									}).catch(function(error) {
										console.log(error);
										$(".alert").addClass("hidden");
										$("#link-update-error").removeClass("hidden");
										displayLinkedAccounts(user);
									});
								}, function(error) {
									console.log(error);
									if (error.code === "auth/email-already-in-use" || error.code === "auth/credential-already-in-use") {
										$(".alert").addClass("hidden");
										$("#link-account-in-use").removeClass("hidden");
										displayLinkedAccounts(user);
									}
									else {
										$(".alert").addClass("hidden");
										$("#link-update-error").removeClass("hidden");
										displayLinkedAccounts(user);
									}
								});
							}
						}
					});


			});
		}

		function confirmAction(title, text, callback) {
			$("#confirm-modal-label").html(title);
			$("#confirm-modal-text").html(text);
			$("#confirm-modal-btn").on("click", callback);
			$(".confirm-modal-close").on("click", function() {
				$("#confirm-modal-btn").off("click", callback);
			});
			$("#confirm-modal").modal("show");
		}
	</script>
	<!-- Modal -->
	<div class="modal fade" id="confirm-modal" tabindex="-1" role="dialog" aria-labelledby="confirm-modal-label">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close confirm-modal-close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="confirm-modal-label">Modal title</h4>
				</div>
				<div class="modal-body">
					<p id="confirm-modal-text"><span id="confirm-modal-text"></span> If you are, re-login below/</p>
					<hr>
					<div class="alert alert-danger hidden" id="confirm-modal-error" role="alert">Error: No user could be found with the combiation of email address and password given. You can try entering your password again, <a href="/account/create/" class="alert-link">
				Creating an account</a>, or <a href="/account/reset/" class="alert-link">Resetting your password</a>.</div>
					<div class="alert alert-danger hidden" id="confirm-modal-accountinvalid" role="alert">The account used to login has not been activated yet. You need to follow a link on a password reset email to activate your account. You can try <a href="/account/verify" class="alert-link">Verifying your email again</a>.</div>
					<div class="alert alert-danger hidden" id="confirm-modal-socialloginerror" role="alert">Unable to log you in. Please try again later.</div>
					<div class="alert alert-danger hidden" id="confirm-modal-popupdenied" role="alert">Popup denied by browser. Please allow the login popup to be displayed to login.</div>

					<label for="email">Current Email Address:</label>
					<input type="text" id="confirm-modal-email" class="form-control">
					<label for="password">Current Password:</label>
					<input type="password" id="confirm-modal-password" class="form-control">
					<br><br>
					<button class="btn btn-primary form-control" id="confirm-modal-login">I am sure. Re-Login</button>
					<hr>
					<p class="text-center">Or:</p>
					<a class="btn btn-block btn-social btn-google social-login" id="confirm-modal-google-login">
						<span class="fa fa-google"></span> I am sure. Re-Login with Google
					</a>
					<a class="btn btn-block btn-social btn-github social-login" id="confirm-modal-github-login">
						<span class="fa fa-github"></span> I am sure. Re-Login with Github
					</a>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default confirm-modal-close" data-dismiss="modal">Cancel</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="import-modal" tabindex="-1" role="dialog" aria-labelledby="import-modal-label">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="import-modal-label">Import Collection</h4>
				</div>
				<div class="modal-body" id="import-modal-main">
					<p>
						Importing a collection will add all the names, descriptions, and file id's stored in a techedit collection export file. If there are overlapping files that exist in both your collection and the export, you will be asked which one to use.
						<b>If you are sure you would like to import a collection from a file, select a </b><code>json</code><b> file below.</b>
					</p>
					<hr>
					<div class="alert alert-danger hidden" role="alert" id="import-file-not-supported">Error. Your browser does not support this. Please try again on a diffrent browser.(We recommend Google Chrome or Firefox)</div>
					<div class="alert alert-danger hidden" role="alert" id="import-file-not-formatted">Error. The file given was not formatted properlly, or does not exist..</div>
					<label for="import-file">Techedit Export File</label>
					<input type="file" id="import-file" accept="application/json">

				</div>
				<div class="modal-body" id="import-modal-loading">
					<p>Loading...</p>

				</div>
				<div class="modal-body" id="import-modal-conflict">
					<h4>A file in the imported collection also exists in your collection!</h4>
					<p><b>File Id</b>:<span id="import-modal-conflict-file-id"></span></p>
					<p>Imported Collection file name:<br><span id="import-modal-conflict-imported-name"></span><br> Imported Collection file description:<br><span id="import-modal-conflict-imported-description"></span>
					</p>
					<p>Your Collection file name:<br><span id="import-modal-conflict-user-name"></span><br> Your Collection file description:<br><span id="import-modal-conflict-user-description"></span>
						<hr>
						<button id="import-modal-conflict-keep" class="btn btn-primary form-control">Keep using your own collection file data</button>
						<button id="import-modal-conflict-keep-all" class="btn btn-primary form-control">Keep using your own collection file data for all future files</button>
						<button id="import-modal-conflict-overwrite" class="btn btn-danger form-control">Overwrite using imported collection file data</button>
						<button id="import-modal-conflict-overwrite-all" class="btn btn-danger form-control">Overwrite using imported collection file data for all future files</button>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary" id="import-collection-btn">Import Collection</button>
				</div>
			</div>
		</div>
	</div>
</body>

</html>
