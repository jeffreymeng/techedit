<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Techedit</title>
    <!-- Bootstrap Core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-select.min.css" rel="stylesheet">
    <!-- Custom CSS -->

    <style>
        body {
            padding-top: 70px;
            /* Required padding for .navbar-fixed-top. Remove if using .navbar-static-top. Change if height of navigation changes. */
        }
    </style>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Techedit</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/new/">New File</a>
                    </li>
                    <li>
                        <a href="/edit/">Edit File</a>
                    </li>
                    <li id="nav-login" class="hidden">
                        <a id="nav-login-link">Login</a>
                    </li>
                    <p id="nav-logout" class="navbar-text navbar-right hidden">You are logged in. <a id="nav-logout-link" class="navbar-link">Logout</a></p>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>
    <!-- Page Content -->
    <div class="container">
        <div class="row">
            <div class="alert alert-danger hidden" role="alert" id="allfieldsrequired">All fields are required</div>

            <div class="alert alert-danger hidden" role="alert" id="nospecialchars">The file name can only contain letters, numbers, dashes(-), underscores(_), slashes(/), and dots(.), and must be 60 charcters or less.</div>
            <div class="col-lg-12 text-center">
                <h1>Create New File</h1><b>All fields are required, and all fields can be changed later.</b>
                <hr>
                <label for="filename">File Name:</label>
                <input class="form-control" id="filename" type="text">
                <label for="filetype">Syntax Highlighting Language</label>
                <select id="filetype" class="selectpicker form-control" data-live-search="true" title="Choose One">
					<option value="java">
						Java
					</option>
					<option value="python">
						Python
					</option>
					<option value="html">
						HTML
					</option>
					<option value="css">
						CSS
					</option>
					<option value="javascript">
						Javascript
					</option>
					<option value="text">
						Text
					</option>
					<option value="swift">
						Swift
					</option>
					
					
				</select>
                <label for="theme">Editor Theme(Only for you, saved on this browser for all future files, not saved on private browsing)</label>
                <select id="theme" class="selectpicker form-control" data-live-search="true" title="Choose One">
					<optgroup label="Light">
						<option value="xcode">
							XCode
						</option>
						<option value="eclipse">
							Eclipse
						</option>
						<option value="github">
							Github
						</option>
						<option value="solarized_light">
							Solarized Light
						</option>
					</optgroup>
					<optgroup label="Dark">
						<option value="monokai">
							Monokai
						</option>
						<option value="twilight">
							Twilight
						</option>
						<option value="solarized_dark">
							Solarized Dark
						</option>
					</optgroup>
				</select>
                <br>
                <br>
                <button class="btn btn-primary form-control" id="submit">Create File</button>

            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container -->
    <!-- jQuery Version 1.11.1 -->
    <script src="/js/jquery.js">
    </script>
    <!-- Bootstrap Core JavaScript -->

    <script src="/js/bootstrap.min.js">
    </script>
    <script src="/js/bootstrap-select.min.js">
    </script>
    <script src="https://www.gstatic.com/firebasejs/3.6.3/firebase.js">
    </script>

    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBQ2E4ISQoIcRsDxfPxzDjbJwmD-r98JYw",
            authDomain: "techedit-63e7f.firebaseapp.com",
            databaseURL: "https://techedit-63e7f.firebaseio.com",
            storageBucket: "techedit-63e7f.appspot.com",
            messagingSenderId: "609280907475"
        };
        firebase.initializeApp(config);
    </script>
    <script src="/js/techedit.js"></script>
    <script>
        /* global $ firebase localStorage */

        $("#theme").selectpicker("val", localStorage.getItem("techedit-opts-local-theme"));

        function getFileID(callback, count) {
            if (!count) {
                count = 0;
            }
            //some error, generated 100 random ID's and still didn't work.
            if (count > 100) {
                callback(false);
            }
            else {
                // no captial I, lowercase l, captial o, and no zero(0) to prevent confusion(in the url bar both look the same)
                // generates 6 digit random ID from pool of 22 chars, not including the following four charcters: iIO0
                var chars = "123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ";
                var result = "";
                for (var i = 6; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)];
                //var invalid = true;

                firebase.database().ref("f" + result).once("value").then(function(snapshot) {
                    if (snapshot.val() === null) {

                        callback(result);
                    }
                    else {
                        getFileID(callback, count + 1);
                    }
                });
            }

        }

        function createFile() {
            var charsregex = /^[a-zA-Z0-9\-_\/\. ]{1,60}$/;
            if ($("#filetype").val() === "" || $("#theme").val() === "" || $("#filename").val() === "") {
                $("#nospecialchars").addClass("hidden");
                $("#allfieldsrequired").removeClass("hidden");
            }

            else if (!(charsregex.test($("#filename").val()))) {
                $("#allfieldsrequired").addClass("hidden");
                $("#nospecialchars").removeClass("hidden");
            }
            else {

                getFileID(function(key) {
                    if (!key) {
                        window.location.href = window.location.href;
                    }
                    else {
                        firebase.database().ref("/f/" + key + "/valid").set(true).then(function() {
                            firebase.database().ref("/f/" + key + "/info/").set({
                                language: $("#filetype").val(),

                                name: $("#filename").val()
                            }).then(function() {
                                localStorage.setItem("techedit-opts-local-theme", $("#theme").val());

                                window.location.href = "https://techedit.jeffkmeng.com/f/" + key;
                            });
                        });

                    }
                });
            }



        }
        $("#submit").click(createFile)
    </script>
</body>

</html>
