<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
	<meta content="" name="description">
	<meta content="Jeffrey Meng" name="author">
	<title>Techedit</title>

	<!-- Favicons -->

	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/favicon/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/favicon/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/favicon/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/favicon/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/favicon/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/favicon/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/favicon/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="/favicon/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="/favicon/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;" />
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="/favicon/mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="/favicon/mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="/favicon/mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="/favicon/mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="/favicon/mstile-310x310.png" />

	<!-- Bootstrap core CSS -->
	<link href="/css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom fonts -->
	<link href="/css/simple-line-icons.css" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css"><!-- Custom styles for this template -->

	<link href="/css/bootstrap-select.css" rel="stylesheet">
	<link href="/css/techedit.css" rel="stylesheet">
	<link href="/css/editor.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
	<a class="navbar-brand" href="/">Techedit</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav-toggle" aria-controls="nav-toggle" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="nav-toggle">

		<span class="navbar-text mx-3">Go to:</span>

		<div class="form-inline mr-auto my-2 my-lg-0">
			<input class="form-control" type="text" placeholder="Existing File ID" id="nav-file-id" tabindex="2">
			<button class="btn btn-secondary" id="nav-file-id-btn">Go!</button>
		</div>
		<ul class="navbar-nav ml-auto mt-2 mt-lg-0">
			<li class="nav-item">
				<a class="nav-link" href="#">New File</a>
			</li>

			<li class="nav-item">
				<a class="nav-link" href="#">Sign in</a>
			</li>
		</ul>
	</div>
</nav>
<div id="loader" class="text-center">
	<div class="spinner">
		<div class="bounce1"></div>
		<div class="bounce2"></div>
		<div class="bounce3"></div>
	</div>
</div>
<div id="split-wrapper" class="hidden">
	<div id="editor-box" class="split">
		<div id="editor"></div>
	</div>
	<div id="sidebar" class="split">
		<div class="p-3">
			<h1>index.html</h1>
			<h3>Settings</h3>
			<div id="settings-form">
				<div class="form-group form-inline">
					<label for="lang-select">Language:</label>
					<select class="selectpicker form-control" id="lang-select">
						<option value="html">HTML</option>
						<option value="css">CSS</option>
						<option value="javascript">Javascript</option>
						<option value="java">Java</option>
						<option value="text">Plain Text</option>

					</select>
				</div>
				<div class="form-group form-inline">
					<label for="lang-select">Theme:</label>
					<select class="selectpicker form-control" id="theme-select">
						<optgroup label="Light">
							<option value="xcode">Xcode</option>
							<option value="dawn">Dawn</option>
							<option value="solarized_light">Solarized Light</option>
						</optgroup>
						<optgroup label="Dark">
							<option value="monokai" selected>Monokai</option>
							<option value="solarized_dark">Solarized Dark</option>
						</optgroup>
					</select>
				</div>
			</div>
			<h3>Active</h3>
		</div>
	</div>


</div>

<!-- Bootstrap core JavaScript -->
<script src="/js/jquery.min.js">
</script>
<script src="/js/bootstrap.bundle.min.js">
</script>
<script src="/js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="/js/split.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/js/bootstrap-select.js" type="text/javascript" charset="utf-8"></script>

<script src="/js/firepad.min.js" type="text/javascript" charset="utf-8"></script>

<script src="https://www.gstatic.com/firebasejs/5.5.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.5/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.5/firebase-database.js"></script>

<script>
	// Initialize Firebase
	var config = {
		apiKey: "AIzaSyABAa5dEDjLd46i01STVlapvKrFFMinTqo",
		authDomain: "techedit-io.firebaseapp.com",
		databaseURL: "https://techedit-io.firebaseio.com",
		projectId: "techedit-io",
		storageBucket: "techedit-io.appspot.com",
		messagingSenderId: "84859966897"
	};
	firebase.initializeApp(config);
</script>
<script src="/js/techedit.js" type="text/javascript" charset="utf-8"></script>

<script>
	function getBrightness(r, g, b) {
		return (r * 299 + g * 587 + b * 114) / 1000;
	}
	function updateSidebarTheme(editor, light) {

		var themeColor = getComputedStyle(editor.renderer.scroller).backgroundColor;

		//convert to int array [r, g, b]
		themeColor = themeColor.replace(/[^\d,]/g, '').split(',');

		var textColor;
		var r = themeColor[0];
		var g = themeColor[1];
		var b = themeColor[2];

		if ((!light && light != null) || getBrightness(r, g, b) < 123) {

			textColor = "#ced4da";
			gutterColor = "#6c757d";
			$('.selectpicker').selectpicker("setStyle", "btn-light", "remove");
			$('.selectpicker').selectpicker("setStyle", "btn-secondary", "add");
		} else {
			textColor = "#000000";
			gutterColor = "#EEEEEE";
			$('.selectpicker').selectpicker("setStyle", "btn-secondary", "remove");
			$('.selectpicker').selectpicker("setStyle", "btn-light", "add");
		}
		var backgroundColor = "rgb(" + r + ", " + g + ", " + b + ")";

		$("#sidebar").css("background-color", backgroundColor);
		$("#sidebar").css("color", textColor);
		$(".gutter").css("background-color", gutterColor);


	}
	function adjustBrightness(color, amt) {

		var usePound = false;

		if (color[0] == "#") {
			color = color.slice(1);
			usePound = true;
		}

		var R = parseInt(color.substring(0,2),16);
		var G = parseInt(color.substring(2,4),16);
		var B = parseInt(color.substring(4,6),16);

		// to make the colour less bright than the input
		// change the following three "+" symbols to "-"
		R = R + amt;
		G = G + amt;
		B = B + amt;

		if (R > 255) R = 255;
		else if (R < 0) R = 0;

		if (G > 255) G = 255;
		else if (G < 0) G = 0;

		if (B > 255) B = 255;
		else if (B < 0) B = 0;

		var RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
		var GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
		var BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

		return (usePound?"#":"") + RR + GG + BB;

	}
	function stopLoading() {
		$("#loader").addClass("hidden");
		$("#split-wrapper").removeClass("hidden");
	}
	function onLanguageChange() {
		editor.getSession().setMode("ace/mode/" + $("#lang-select").val());
		firebase.database().ref("/f/test/data/language/").set($("#lang-select").val());
	}
</script>
<script>
	var editor = ace.edit("editor");

	editor.setTheme("ace/theme/monokai");
	editor.getSession().setMode("ace/mode/html");
	editor.setShowPrintMargin(false);


	if( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ) {
		$('.selectpicker').selectpicker('mobile');
	}


	var split = Split(["#editor-box", "#sidebar"],
		{
			onDragEnd:function() {
				editor.resize();
			},
			minSize:0,
			sizes: [75, 25],
		});

	editor.renderer.on("themeLoaded", function() {
		updateSidebarTheme(editor);

	});

	// Get Firebase Database reference.
	var firepadRef = firebase.database().ref("/f/test/");
	firebase.database().ref("/f/test/data/").once("value").then(function(snapshot) {
		var data = snapshot.val();
		$("#lang-select").selectpicker("val", data.language);
		$("#lang-select").on("change", onLanguageChange);
		var firepad = Firepad.fromACE(firepadRef, editor, {
		});

		firepad.on("ready", function() {
			stopLoading();
		});

	});
	firebase.database().ref("/f/test/data/language/").on("value", function(snapshot) {
		$("#lang-select").off("change", onLanguageChange);
		var lang = snapshot.val();
		$("#lang-select").selectpicker("val", lang);
		editor.getSession().setMode("ace/mode/" + lang);
		$("#lang-select").on("change", onLanguageChange);
	});



	$("#theme-select").change(function() {
		editor.setTheme("ace/theme/" + $("#theme-select").val());
		updateSidebarTheme(editor);

	});
</script>
</body>
</html>